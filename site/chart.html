<!doctype html>
<html lang="nl">
<head>
    <meta charset="utf-8">
    <title>Oulu Parking Stats</title>
    <script type="text/javascript" src="Chart.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
</head>

<body>
<script type="text/javascript">

    function zeroPad(num, places) {
      var zero = places - num.toString().length + 1;
      return Array(+(zero > 0 && zero)).join("0") + num;
    }

    function drawLineChart(id, elementId) {

        // Add a helper to format timestamp data
        Date.prototype.formatMMDDYYYY = function() {
            return (this.getDate() + "." + (this.getMonth() + 1) + "." +  this.getFullYear() + " " + this.getHours() + ":" +zeroPad(this.getMinutes(),2));
        };

        var jsonData = $.ajax({
            //url: 'http://108.61.198.137:8080/parking-api/stats' + id,
            url: 'http://localhost:4567/stats/' + id,
            dataType: 'json'
        }).done(function (results) {

            // Split timestamp and data into separate arrays
            var labels = [], datasets=[];
            var free=[], total=[];

            var sorted = results.sort(function(a,b) {
              if (new Date(a["date"]) < new Date(b["date"]))
                return -1;
              else if (new Date(a["date"]) > new Date(b["date"]))
                return 1;
              else
                return 0;
            }); // sort

            sorted.forEach(function(status) {
                var date = new Date(status["date"]).formatMMDDYYYY();
                labels.push(date);
                free.push(parseInt(status["free"]));
                total.push(parseInt(status["total"]));
                console.log("Sorting, : " + date);
            }); // foreach

            var r = Math.floor((Math.random() * 150) + 100);
            var g = Math.floor((Math.random() * 150) + 100);
            var b = Math.floor((Math.random() * 150) + 100);
            console.log("rgb" + r + ", " + g + ", " + b + ", ")

            var dataset2 = {
                label                 : "Paikkoja yhteens√§",
                fillColor             : "rgba(251,187,205,0.2)",
                strokeColor           : "rgba(251,187,205,1)",
                pointColor            : "rgba(251,187,205,1)",
                pointStrokeColor      : "#fff",
                pointHighlightFill    : "#fff",
                pointHighlightStroke  : "rgba(251,187,205,1)",
                data                  : total
            };
            datasets.push(dataset2);

            var dataset1 = {
                label                 : "Paikkoja vapaana",
                fillColor             : "rgba(151,187,205,0.2)",
                strokeColor           : "rgba(151,187,205,1)",
                pointColor            : "rgba(151,187,205,1)",
                pointStrokeColor      : "#fff",
                pointHighlightFill    : "#fff",
                pointHighlightStroke  : "rgba(151,187,205,1)",
                data                  : free
            };
            datasets.push(dataset1);

            // Create the chart.js data structure using 'labels' and 'data'
            var tempData = {
                labels : labels,
                datasets : datasets
            };

            // Get the context of the canvas element we want to select
            var ctx = document.getElementById(elementId).getContext("2d");

            // Instantiate a new chart
            var myLineChart = new Chart(ctx).Line(tempData, {
                showXLabels: 12
            });

        }); // ajax
    }

    drawLineChart(1, "myChart");
    drawLineChart(2, "myChart2");

</script>
<div>
    <section>
        <article>
            <label for = "myChart">
                Parking lot statistics<br />
            </label>
            <canvas id="myChart" width="800" height="400">
            </canvas>
            <label for = "myChart2">
                Parking lot statistics<br />
            </label>
            <canvas id="myChart2" width="800" height="400">
            </canvas>
        </article>
    </section>
</div>
</body>
</html>
